# 🎮 碰撞系统使用说明

## 📋 功能概述

现在支持**自定义碰撞半径**，让管理员可以精确控制每个模型的碰撞行为！

---

## ✨ 三种碰撞模式

### 1. 🚫 **无碰撞模式** (collisionRadius = 0)
- **玩家可以穿过模型**
- 适用于：背景装饰、墙体、建筑物等
- 用途：允许玩家自由探索，进入被遮挡的区域

### 2. 🎯 **自定义碰撞** (collisionRadius > 0)
- **精确控制碰撞距离**
- 范围：0.5m - 10m
- 适用于：重要展品、需要精确控制距离的文物
- 用途：防止玩家靠得太近或保持合适的观赏距离

### 3. 🤖 **自动计算模式** (collisionRadius = undefined/空)
- **系统根据模型大小自动计算**
- 计算公式：`Math.max(scale * 1.2, 1.5)`
- 适用于：常规模型，默认行为
- 用途：省时省力，自动适应模型大小

---

## 🛠️ 使用方法

### 步骤 1: 进入管理员模式
1. 访问网站，点击管理员登录
2. 输入密码：`admin2025`
3. 进入编辑模式

### 步骤 2: 选择模型
1. 点击场景中的模型进行选择
2. 右侧会显示**属性面板**

### 步骤 3: 设置碰撞半径

#### 方式 A: 使用滑块
```
碰撞半径 (m) - 玩家与模型的碰撞距离
━━━━━━●━━━━━━━━━━━━━━  [3.5]
```
- 拖动滑块到 **最左边 (0)** = 无碰撞
- 拖动到合适位置 = 自定义距离
- 实时预览效果

#### 方式 B: 直接输入数值
```
碰撞半径 (m)
┌─────────────┐
│   3.5       │  输入数值
└─────────────┘
```
- 输入 `0` = 无碰撞
- 输入数字 = 精确控制
- 清空/留空 = 自动计算

---

## 📊 状态指示

### 在输入框下方会显示当前状态：

```
✓ 无碰撞 - 玩家可穿过          (绿色，collisionRadius = 0)
自动计算 - 基于模型尺寸        (灰色，collisionRadius = undefined)
碰撞半径: 3.5m                (黑色，自定义数值)
```

---

## 🎯 实际应用场景

### 场景 1: 博物馆建筑
```
问题：墙体、柱子阻挡玩家移动
解决：设置 collisionRadius = 0
效果：玩家可以自由穿过，探索所有区域
```

### 场景 2: 贵重文物
```
问题：需要保持观赏距离
解决：设置 collisionRadius = 2.0
效果：玩家保持 2 米距离，不会碰到展品
```

### 场景 3: 大型模型
```
问题：自动碰撞太大/太小
解决：设置 collisionRadius = 5.0
效果：根据实际需要精确调整
```

### 场景 4: 装饰物
```
问题：小装饰品不应阻挡移动
解决：设置 collisionRadius = 0
效果：玩家可穿过，不影响行走
```

---

## 💡 最佳实践

### ✅ 推荐做法

1. **建筑/墙体**: 设为 `0`（无碰撞）
2. **主要展品**: 使用自定义值 `2-4m`
3. **小装饰**: 设为 `0` 或 `1m`
4. **大型雕塑**: 使用 `4-6m`
5. **常规物品**: 留空（自动）

### ❌ 避免

- 不要给所有模型设置相同的碰撞半径
- 不要设置过大的碰撞半径（> 8m）
- 不要忘记测试游客模式的体验

---

## 🧪 测试流程

### 1. 设置碰撞
```
管理员模式 → 选择模型 → 调整碰撞半径 → 保存
```

### 2. 切换到游客模式
```
退出编辑模式 → 点击屏幕进入第一人称
```

### 3. 测试移动
```
使用 WASD 移动 → 尝试穿过模型 → 验证碰撞行为
```

### 4. 调整优化
```
返回编辑模式 → 根据体验调整 → 重复测试
```

---

## 🔧 技术说明

### 碰撞检测逻辑
```typescript
if (point.collisionRadius === 0) {
  // 无碰撞，直接跳过
  continue
} else if (point.collisionRadius !== undefined) {
  // 使用自定义碰撞半径
  collisionRadius = point.collisionRadius
} else {
  // 自动计算：基于模型缩放
  collisionRadius = Math.max(scale * 1.2, 1.5)
}
```

### 性能优化
- 使用圆形碰撞检测（高效简单）
- 每帧仅检测与模型中心的距离
- 玩家半径固定为 0.5m
- 场景边界检测已移除（允许自由探索）

---

## 📝 配置持久化

所有碰撞设置会自动保存到 `localStorage`，包括：
- ✅ 自定义碰撞半径
- ✅ 模型位置、旋转、缩放
- ✅ AI 提示词和描述

### 导出/导入
使用**模型库**面板的 **导出/导入** 按钮：
- 导出场景配置为 JSON
- 在其他设备导入配置
- 分享给团队成员

---

## 🎉 总结

通过自定义碰撞半径，你可以：
- ✅ 让玩家穿过建筑物和装饰
- ✅ 精确控制展品的保护距离
- ✅ 创造更流畅的游览体验
- ✅ 解决隐藏碰撞盒问题

**快去试试吧！** 🚀

